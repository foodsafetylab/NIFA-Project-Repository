---
title: "FIeld trials CA 2022_v1"
author: "JQP"
date: "2023-06-29"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r echo=F}
library(tidyverse)
library(MASS)
library(car)
```


```{r}
raw<-read.csv("Exp_1_results_organized.csv")
str(raw)
Fanoe<-read.csv("Experiment_1_trimmed.csv")
str(Fanoe)
Fanoe$Zone<-as.factor(Fanoe$Zone)
Fanoe$Top.bottom<-as.factor(Fanoe$Top.bottom)
Fanoe$Wet.dry<-as.factor(Fanoe$Wet.dry)
Fanoe$Hand.msd<-as.factor(Fanoe$Hand.msd)
Fanoe$Opportunity<-as.factor(Fanoe$Opportunity)
Fanoe$Sample.Type<-as.factor(Fanoe$Sample.Type)
Fanoe$Log.Coli.<-as.numeric(Fanoe$Log.Coli.)
str(Fanoe) #This contains all original and repeated samples, 
SumFanoe<-Fanoe%>%group_by(Sample.Type, Opportunity,Wet.dry, Hand.msd)%>%summarise(n=n())
knitr::kable(SumFanoe)
```
**Dataset containing all samples, all originals and all repeated. Originals that lacked information, were TNTC or odd results. Produce original= 22; Produce repeat= 14; Dry cloths msd Original= 11;Dry cloths msd repeated= 3; Wet cloths hand original=6;Wet cloths hand repeat=4; Wet cloths MSD original=15; Wet cloths MSD repeat=11**
*Initial Visuals*

```{r echo=FALSE}
APC_MTvPr<-ggplot(data= Fanoe, aes(x=Zone, y=Log.APC. , col= Sample.Type))+
  geom_boxplot(outlier.alpha = 0)+theme(plot.title = element_text(size = rel(1.2), face = "bold"), axis.text = element_text(size= 10, angle=0, hjust=0.5), axis.title = element_text(size=12))+
  expand_limits(y=0)+
  scale_y_continuous("Best Estimate APC (Log CFU/g)", breaks= c(1,2,3,4,5,6,7))+
  geom_point(position=position_jitterdodge(),alpha=1)+
  ggtitle("Overall PreHarvest Bacterial Recovery Comparison - Swab v Composite Tissue ")
APC_MTvPr+facet_grid(.~Opportunity)
```

```{r echo=FALSE}
Colif_MTvPr<-ggplot(data= Fanoe, aes(x=Zone, y=Log.Coli. , col= Sample.Type))+
  geom_boxplot(outlier.alpha = 0)+theme(plot.title = element_text(size = rel(1.2), face = "bold"), axis.text = element_text(size= 10, angle=0, hjust=0.5), axis.title = element_text(size=12))+
  expand_limits(y=0)+
  scale_y_continuous("Best Estimate Coliforms (Log CFU/g)", breaks= c(1,2,3,4,5,6,7))+
  geom_point(position=position_jitterdodge(),alpha=1)+
  ggtitle("Overall PreHarvest Bacterial Recovery Comparison - Swab v Composite Tissue ")
Colif_MTvPr+facet_grid(.~Opportunity)
```
*Overall, higher APC and Coliforms on repeated samples, why?* 

*_However, following discussion on 07/11/22, we kept the originals and filled in the gaps with the repeated samples_*

```{r}
adj_Fanoe<-read.csv("Experiment_1_adjusted trim.csv")
adj_Fanoe$Zone<-as.factor(adj_Fanoe$Zone)
adj_Fanoe$Top.bottom<-as.factor(adj_Fanoe$Top.bottom)
adj_Fanoe$Wet.dry<-as.factor(adj_Fanoe$Wet.dry)
adj_Fanoe$Hand.msd<-as.factor(adj_Fanoe$Hand.msd)
adj_Fanoe$Opportunity<-as.factor(adj_Fanoe$Opportunity)
adj_Fanoe$Sample.Type<-as.factor(adj_Fanoe$Sample.Type)
str(adj_Fanoe)
wkngsamples_Fanoe<-adj_Fanoe%>%group_by(Sample.Type, Wet.dry, Hand.msd)%>%summarise(n=n())
totalecoli<-adj_Fanoe%>%group_by(Sample.Type, Log.E.coli.)%>%summarise(count=n())
knitr::kable(wkngsamples_Fanoe)
knitr::kable(totalecoli)
```
**Updated dataset consists on 32 swabs and 22 produce samples, N=54. MSD Dry cloths n=11, Prehydrated cloths, hand n=6, Prehydrated cloths, MSD n= 15.** **Generic *E. coli* Neg swabs= 26, Pos swabs= 6; Neg Produce= 13, Pos produce= 9**

*Graphs for overall visualization of all samples, based on field parameters and head collection*
```{r echo=FALSE}
OvPH_MTvTissue_APC<-ggplot(data= adj_Fanoe, aes(x=Sample.Type, y=Log.APC. , col= Sample.Type))+
  geom_boxplot(outlier.alpha = 0)+theme(plot.title = element_text(size = rel(1.2), face = "bold"), axis.text = element_text(size= 10, angle=0, hjust=0.5), axis.title = element_text(size=12))+
  expand_limits(y=0)+
  scale_y_continuous("Best Estimate APC (Log CFU/g)", breaks= c(1,2,3,4,5,6,7,8,9))+
  geom_point(position=position_jitterdodge(),alpha=1)+
  ggtitle("Overall PreHarvest APC Recovery Comparison - Aggregative Swab v Composite Produce Samples")
OvPH_MTvTissue_APC+facet_grid(Hand.msd~Wet.dry)

OvPH_MTvTissue_Colif<-ggplot(data= adj_Fanoe, aes(x=Sample.Type, y=Log.Coli. , col= Sample.Type))+
  geom_boxplot(outlier.alpha = 0)+theme(plot.title = element_text(size = rel(1.2), face = "bold"), axis.text = element_text(size= 10, angle=0, hjust=0.5), axis.title = element_text(size=12))+
  expand_limits(y=0)+
  scale_y_continuous("Best Estimate Coliforms (Log CFU/g)", breaks= c(1,2,3,4,5,6,7,8,9))+
  geom_point(position=position_jitterdodge(),alpha=1)+
  ggtitle("Overall PreHarvest Coliform Recovery Comparison - Aggregative Swab v Composite Produce Samples")
OvPH_MTvTissue_Colif+facet_grid(Hand.msd~Wet.dry)

Zone_OvPH_MTvTissue_APC<-ggplot(data= adj_Fanoe, aes(x=Zone, y=Log.APC. , col= Sample.Type))+
  geom_boxplot(outlier.alpha = 0)+theme(plot.title = element_text(size = rel(1.2), face = "bold"), axis.text = element_text(size= 10, angle=0, hjust=0.5), axis.title = element_text(size=12))+
  expand_limits(y=0)+
  scale_y_continuous("Best Estimate APC (Log CFU/g)", breaks= c(1,2,3,4,5,6,7,8,9))+
  geom_point(position=position_jitterdodge(),alpha=1)+
  ggtitle("Overall PreHarvest APC Recovery Comparison by Zone- Aggregative Swab v Composite Produce Samples")
Zone_OvPH_MTvTissue_APC+facet_grid(Hand.msd~Wet.dry)

Zone_OvPH_MTvTissue_Colif<-ggplot(data= adj_Fanoe, aes(x=Zone, y=Log.Coli. , col= Sample.Type))+
  geom_boxplot(outlier.alpha = 0)+theme(plot.title = element_text(size = rel(1.2), face = "bold"), axis.text = element_text(size= 10, angle=0, hjust=0.5), axis.title = element_text(size=12))+
  expand_limits(y=0)+
  scale_y_continuous("Best Estimate Coliforms (Log CFU/g)", breaks= c(1,2,3,4,5,6,7,8,9))+
  geom_point(position=position_jitterdodge(),alpha=1)+
  ggtitle("Overall PreHarvest Coliform Recovery Comparison by Zone- Aggregative Swab v Composite Produce Samples")
Zone_OvPH_MTvTissue_Colif+facet_grid(Hand.msd~Wet.dry)
```

##Cleaning for analysis 
###Analysis of Agg Swabs

```{r echo=F}
Only_Swabs<-adj_Fanoe%>%filter(Sample.Type=="Aggregative Swab")
Only_Swabs_noEcoli<-Only_Swabs[,-13]
str(Only_Swabs_noEcoli)
Everything_but_Ecoli<-adj_Fanoe[,-13]
str(Everything_but_Ecoli)
```

#Statistical Analysis - BASIC

```{r echo=F}
lm_APC<-lm(Log.APC. ~ Sample.Type, data=adj_Fanoe)
locAPClm<-lm(Log.APC. ~ Sample.Type*Zone, data=adj_Fanoe)
shapiro.test(residuals(lm_APC))##normatility p=0.008401
leveneTest(Log.APC.~Sample.Type, data=adj_Fanoe)#heterogenous p=0.00039
#leveneTest(APClm)
anova(lm_APC) #effect in sample type p<0.01212 -- poshoc test needed


lm_APC_drywet<-lm(Log.APC. ~ Wet.dry, data=Only_Swabs)
lm_APC_press<-lm(Log.APC. ~ Hand.msd, data=Only_Swabs)
lm_APC_2fac<-lm(Log.APC.~Hand.msd*Wet.dry, data=Only_Swabs)
locAPClm<-lm(Log.APC.~ Wet.dry*Zone*Hand.msd, data=Only_Swabs)
plantAPClm<-lm(Log.APC. ~ Hand.msd*Wet.dry*Top.bottom, data=Only_Swabs)
#shapiro.test(residuals(lm_APC))##normatility p=0.017
#leveneTest(lm_APC)#heterogenous p=0.03
#leveneTest(APClm)
Hydration_Effect<-anova(lm_APC_drywet) #effect in wet-dry p<6.753-6 -- poshoc test needed
Pressure_Effect<-anova(lm_APC_press)#no effect from pressure
BothFactors<-anova(lm_APC_2fac)#Hydration matters most 3.008e-5
Zone_Effect<-anova(locAPClm) #zones had no effect
InPlantLoc_effect<-anova(plantAPClm)#place in plant had no effect

knitr::kable(Hydration_Effect)
knitr::kable(Pressure_Effect)
knitr::kable(BothFactors)
knitr::kable(Zone_Effect)
knitr::kable(InPlantLoc_effect)
```


#Appendix
```{r}

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
